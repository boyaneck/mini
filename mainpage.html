<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cheer Up!</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/reset-css@5.0.2/reset.css" />
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet" />




  <!-- GSAP & ScrollToPlugin -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"
    integrity="sha512-16esztaSRplJROstbIIdwX3N97V1+pZvV33ABoG1H2OyTttBxEGkTsoIVsiP1iaTtM8b3+hu2kB6pQ4Clr5yug=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollToPlugin.min.js"
    integrity="sha512-v/m68W+vaGN/6igoyFpd4GlQzu0jx9/n5gr2PKq5vif+RObyGKHse384YHrOULaxZ810XhlHUrmB3U8UnPB19Q=="
    crossorigin="anonymous" referrerpolicy="no-referrer"></script>

  <link
    href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;500;600;700;800&family=Roboto:wght@300&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="./css/main.css" />
  <link rel="stylesheet" type="text/css" href="css/button.css">
  <link rel="stylesheet" type="text/css" href="css/profile.css">


  <!-- <script defer src="./js/main.js"></script> -->


  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-app.js";
    import { getFirestore } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { collection, addDoc, deleteDoc, doc, updateDoc } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    import { getDocs } from "https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore.js";
    // import { deleteDoc, doc } from "firebase/firestore";

    
    // Firebase êµ¬ì„± ì •ë³´ ì„¤ì •
    const firebaseConfig = {
      apiKey: "AIzaSyDCMmkPhiF-vFVmadyBDgVoMHGL8tn-G9M",
      authDomain: "mini-intro.firebaseapp.com",
      projectId: "mini-intro",
      storageBucket: "mini-intro.appspot.com",
      messagingSenderId: "634745339046",
      appId: "1:634745339046:web:a3c1932b0c8940e0290867",
      measurementId: "G-L43KNKS7DB",
    };


    // Firebase ì¸ìŠ¤í„´ìŠ¤ ì´ˆê¸°í™”
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);


    let docs = await getDocs(collection(db, "messages"));    


    let data = []
    docs.forEach((doc) => {
      let row = {data: doc.data(), id:doc.id};
      data.push(row)

      let name = row['name'];
      let command = row['command'];
      let id = row['id']; // ë¬¸ì„œ ë‚´ id

      let supportText = `í˜„ì¬ <span>${docs.size}</span> ëª… ì‘ì› ì¤‘!`
      $('.support').html(supportText)
    })
    
    
      // ID ìˆœì„œë¡œ ë°ì´í„° ë‚´ë¦¼ì°¨ìˆœ ì •ë ¬
    let sortData = data.sort((a,b) => {
      return b.data.id - a.data.id
    })
    // console.log(sortData);
    console.log(sortData);

    sortData.forEach(el => {
      // ëœë¤í•œ ê²Œì‹œë¬¼ ë°°ê²½ìƒ‰
      let number = Math.floor(Math.random() * (5 - 1 + 1) + 1);
      let color = ['#48767B', '#E26559', '#84B9C0', '#FFE697', '#C5D7F2', '#2B7799'];
      let color1 = color[number];

      // ì¶”ê°€ í•  ê²Œì‹œë¬¼ HTML
      let temp_html = 
        `
        <li class="command" style="background-color:${color1}">
          <span id="name">${el.data.name}</span>: <span id="command">${el.data.command}</span>
          <div data-id=${el.id} class="del"></div>
          <div data-id=${el.id} class="edit"></div>
          <div class="cmdbtn">
            <button class="editbtn">ìˆ˜ì •</button>
            <button class="deletebtn" onclick="()=>handleDeleteButtonClick()">ì‚­ì œ</button>
          </div>
        </li>
        `
      document.querySelector('#commands').insertAdjacentHTML("beforeend", temp_html)
    })
    
        
      
    
    
    // ì‚­ì œ ë²„íŠ¼
    $('#commands').on("click", ".deletebtn", async function() {
      const commandEl = $(this).closest(".command"); // ê°€ì¥ ê°€ê¹Œìš´ ê°’ ê°€ì ¸ì˜´
      const storedId = commandEl.find(".del").data('id');  // .delì„ ì°¾ì•„ í…ìŠ¤íŠ¸ê°’ì„ ê°€ì ¸ì˜¨ë‹¤.
      console.log(storedId);

      try {
        const docRef = doc(db, "messages", storedId); // await deleteDoc(doc(db, "messages", storedId))
        await deleteDoc(docRef);
        window.location.reload(); 
      } catch (err) {
        console.log('err', err)
      }

    })

    // ìˆ˜ì •
    $('#commands').on("click", ".editbtn", async function(e) {
      const commandEl = $(this).closest(".command"); // ê°€ì¥ ê°€ê¹Œìš´ ê°’ ê°€ì ¸ì˜´
      const username = commandEl.find("#name").text();
      const text = commandEl.find("#command").text();
      const storedId = commandEl.find(".edit").data('id'); 
      window.location.href=`./Pages/edit.html?name=${username}&&text=${text}&&id=${storedId}`
      try {
        const docRef = doc(db, "messages", storedId); // await deleteDoc(doc(db, "messages", storedId))
        await updateDoc(docRef, {name, text, id});
        window.location.reload(); 
      } catch (err) {
        console.log('err', err)
      }

    })

    $('.mini_profile').click(async function() {
      location.href="./Pages/detailPage/detail.html?id="
    })


    // TOKEN
    function getToken() {
      const token = localStorage.getItem('token');
      return token
    }
    
    function isAdmin() {
      if (getToken() === null) {
      $('.deletebtn').addClass('hide')
      $('.editbtn').addClass('hide')
  }
}
getToken();
isAdmin();

  </script>


</head>

<body>
  <!-- HEADER -->
  <header>
    <div class="inner">
      <div class="item">
        <!-- TITLE -->
        <div class="team_title">Team T2F1</div>
        <!-- TEAM INFO -->
        <div class="team_contents">
          <div class="team_info">
            <ul>
              <h3>TEAM</h3>
              <ul>
                <h4>íŒ€ T2F1</h4>
                <img src="./image/IMG_2343.jpg" alt="team">
                <p>ìŠ¤íŒŒë¥´íƒ€ì½”ë”©í´ëŸ½ React ë¶€íŠ¸ìº í”„ì˜ ì²« í”„ë¡œì íŠ¸ë¥¼ í•¨ê»˜ ì§„í–‰í•˜ê²Œ ëœ íŒ€ T2F1 ì…ë‹ˆë‹¤.</p>
              </ul>
            </ul>
            <ul>
              <h3>MERBER</h3>
              <ul>
                <li>
                  <a href="./Pages/detailPage/detail.html?id=0" class="mini_profile">
                    <span>ğŸ˜</span>
                  </a>
                  <h4>ì§„ë¯¼ìš©<p>ë‹¤ê°™ì´ LEVEL UP!</p>
                  </h4>
                </li>
                <li>
                  <a href="./Pages/detailPage/detail.html?id=1" class="mini_profile">
                    <span>ğŸ€</span>
                  </a>
                  <h4>ê¹€ì€ë¹„<p>í•­ìƒ ì¦ê²ê²Œ í‚µê³ ì‰!</p>
                  </h4>
                </li>
                <li>
                  <a href="./Pages/detailPage/detail.html?id=2" class="mini_profile">
                    <span>ğŸƒ</span>
                  </a>
                  <h4>ì´ë½ê· <p>ê°€ë³´ìêµ¬ìš°~.~</p>
                  </h4>
                </li>
              </ul>
            </ul>
            <ul>
              <h3>PROJECT</h3>
              <ul>
                <h4>í”„ë¡œì íŠ¸ Cheer Up!</h4>
                <p>ì•½ 5ê°œì›” ê°„ì˜ ê°œë°œì ê³¼ì •ì„ ì˜ ë§ˆë¬´ë¦¬ í•˜ì—¬ â€œì–´ì—¿í•œ ì£¼ë‹ˆì–´ ê°œë°œìâ€ë¡œ ì„±ì¥í•˜ê¸° ìœ„í•´ ì„œë¡œë¥¼ ì‘ì›í•˜ëŠ” ë§ˆìŒì„ ë‹´ì€ í”„ë¡œì íŠ¸ ì…ë‹ˆë‹¤!</p>
              </ul>
            </ul>
            <ul>
              <h3>GOAL</h3>
              <ul>
                <h4>ì•ìœ¼ë¡œì˜ íŒ€ ëª©í‘œ</h4>
                <p>ì‚¬ìš©ìë“¤ì˜ ë‹ˆì¦ˆë¥¼ íŒŒì•…í•˜ê³  ë¶„ì„í•˜ì—¬ ìš”êµ¬í•œ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ë§ì€ ì‚¬ìš©ìë“¤ì´ ì´ìš©í•  ìˆ˜ ìˆëŠ” í”„ë¡œê·¸ë¨ì„ ê°œë°œí•˜ì!</p>
              </ul>
            </ul>
          </div>
        </div>
  </header>

  <!-- PROFILE -->
  <div class="profile">



      <div class="team_profiles">
        <div class="profile_cards">
          <a href="./Pages/detailPage/detail.html?id=0">
            <div class="image" style="text-align: center; height: 200px">
              <img src="image/img0.jpg" alt="" class="p1" />
              <img src="image/IMG_2344.jpg" alt="" class="p2" />
            </div>
          </a>
          <a href="./Pages/detailPage/detail.html?id=1">
            <div class="image" style="text-align: center; height: 200px">
              <img src="image/img1.jpg" alt="" class="p1" />
              <img src="image/IMG_2325.jpg" alt="" class="p2" />
            </div>
          </a>
          <a href="./Pages/detailPage/detail.html?id=2">
            <div class="image" style="text-align: center; height: 200px">
              <img src="image/img2.jpg" alt="" class="p1" />
              <img src="image/IMG_2345.jpg" class="p2" />
            </div>
          </a>
        </div>


      </div>



  </div>

  <!-- CHEERING MESSAGE -->
  <div class="message">
      <h4 class="support"></h4>
      <button class="message_button" onclick="location.href='./Pages/reply.html'">ì‘ì›ë©”ì‹œì§€ ë‚¨ê¸°ê¸°</button>
      <ul id="commands" class="commands">
      </ul>
  </div>


  <!-- FOOTER -->
  <footer>
    <div class="inner">
    </div>
  </footer>

  <!-- ìŠ¤í¬ë¡¤ ê¸¸ ê²½ìš° ì‚¬ìš© -->
  <!-- <div id="to-top">
    <div class="material-icons">arrow_upward</div>
  </div> -->

</body>

</html>